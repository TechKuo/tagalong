<html>

<!-- Need jquery to run the below scripts.  oauth.js and sha1.js are used to authenticate yelp api call -->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
    <script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/oauth.js"></script>
    <script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/sha1.js"></script>     
<body>

<script type="text/javascript">

  var auth = {
  //Keeling auth codes
  consumerKey: "3FKCLMgc0s45MZHaSay1gA",
  consumerSecret: "ydBwv2G2Zdc5QirV6XGP48IC1Lg",
  accessToken: "bFTinLpgGpsJE6t1g2Y2rQPvuN7UJxIX",
  accessTokenSecret: "s6pNoE8aEy8YdkejTt4VhyPYVBM",
  serviceProvider: {
    signatureMethod: "HMAC-SHA1"
  }
};

//default term and location 
var terms = 'food';
var near = 'San+Francisco';

//create prompt to retrieve user selected city
var near=prompt("Please enter the city","San+Francisco");

var accessor = {
  consumerSecret: auth.consumerSecret,
  tokenSecret: auth.accessTokenSecret
};

//begin list of parameters see:  https://www.yelp.com/developers/documentation/v2/search_api  
//useful parameters 'term' 'limit' 'location'
parameters = [];
parameters.push(['term', terms]);
parameters.push(['location', near]);
parameters.push(['callback', 'cb']);
parameters.push(['oauth_consumer_key', auth.consumerKey]);
parameters.push(['oauth_consumer_secret', auth.consumerSecret]);
parameters.push(['oauth_token', auth.accessToken]);
parameters.push(['oauth_signature_method', 'HMAC-SHA1']);

//HTTP GET request
var message = {
  'action': 'http://api.yelp.com/v2/search',
  'method': 'GET',
  'parameters': parameters
};

OAuth.setTimestampAndNonce(message);
OAuth.SignatureMethod.sign(message, accessor);

var parameterMap = OAuth.getParameterMap(message.parameters);
parameterMap.oauth_signature = OAuth.percentEncode(parameterMap.oauth_signature)
console.log(parameterMap);

var bestRestaurant = "Some random restaurant";

//search results are stored in data and each business has their own ID
//when we send our request we receive an array of business IDs
//a limit=10 would give array [0-9] we then iterate through array and
//print what we need / want

$.ajax({
  'url': message.action,
  'data': parameterMap,
  'cache': true,
  'dataType': 'jsonp',
  'jsonpCallback': 'cb',
  'success': function(data, textStats, XMLHttpRequest) {
    console.log(data);
    

document.write("<h1>The 10 best restaurants are listed for the following city: </h1>");
document.write("<h1>");
document.write(near);
document.write("<\h1>");
var i;

for(i=0; i<=10; i= i+1){
        document.write("<p>");  
        document.write(data.businesses[i].name);
        document.write("   Rated   ");
        document.write(data.businesses[i].rating);
        document.write("      ");
        document.write(data.businesses[i].phone);
        document.write("<\p>");  
   }

  }
});
</script>
</body>
</html>